name: Sort Metadata Files

on:
  workflow_dispatch:

permissions:
  id-token: write
  contents: write

env:
  MOVIE_METADATA_FILE: movie-metadata.yml
  SHOW_METADATA_FILE: show-metadata.yml

jobs:
  sort:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        id: checkout
        uses: actions/checkout@v4
      
      - name: Update metadata file with movie sorting
        run: bash "functions/yaml/sort-metadata-file.sh" "$MOVIE_METADATA_FILE"
      
      - name: Update metadata file with show sorting
        run: bash "functions/yaml/sort-metadata-file.sh" "$MOVIE_METADATA_FILE"
      
      - name: Commit Changes to Main
        id: commit-changes
        run: |
          git config --global user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git config --global user.name "github-actions[bot]"
          git add ${{ env.MOVIE_METADATA_FILE }}
          git add ${{ env.SHOW_METADATA_FILE }}
          git diff-index --quiet main || git commit -m "Sorted Metadata Files" && git push
